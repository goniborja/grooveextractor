Documento de Arquitectura y Migración: Book of Drums V2 (Pro)
1. Filosofía del Proyecto
Estándar: Profesional. Cero "drift" (desfase).

Motor: Migración total de pygame a sounddevice + numpy (Audio Callback como reloj maestro).

Interfaz: PyQt6 estricto (Enums completos, tipado fuerte).

Idioma: Internacionalización (i18n) completa en Euskera vía CSV/JSON externo.

2. Arquitectura de Audio (Motor Pro)
Librería Core: sounddevice con fallback automático (WASAPI Exclusive -> WASAPI Shared).

Callback: Toda la lógica de secuenciación ocurre dentro del callback de audio. Prohibido usar QTimer o time.sleep para música.

Gestión de Samples: Precarga de arrays numpy (float32).

3. Sincronización Inteligente (Smart Sync)
Entrada de Audio:

Detección de BPM robusta usando madmom (optimizado para Reggae/Ska).

Selector de Rol:

Modo Guitarra: Filtro Paso-Alto (>400Hz). Prioridad a detección de Off-beats (contratiempos/skank).

Modo Bajo: Filtro Paso-Bajo (<200Hz). Prioridad a detección de Downbeats (golpes a tierra) y transitorios de baja frecuencia.

Alineación (Cero Absoluto):

El sistema calculará el desplazamiento (offset) del primer Beat 1.

Exportación de Audio: Se usará Broadcast WAV (BWF). Se incrustará el Time Reference en los metadatos del WAV para que los DAWs (Cubase) coloquen el audio en el punto exacto de la línea de tiempo, respetando el silencio inicial virtual.

4. Sistema de Exportación Híbrido
Canal A: Audio Rápido (.wav)

Renderizado interno con el motor de Python.

Para previsualización y uso rápido.

Canal B: Producción (.mid)

Generación de archivo MIDI estándar.

Mapeo: General MIDI (GM) (Bombo=36, Caja=38, HH=42).

Humanización Previa:

Velocity: Dinámica basada en el patrón (acentos vs ghost notes).

Micro-timing: Las notas no se cuantizarán al 100% rígido, sino que heredarán el "swing" o desplazamiento detectado en el análisis de audio original (si el usuario lo desea).

5. Sistema de Idiomas (Euskera)
Sin Hardcoding: Ningún texto visible en el código Python.

Fuente de Verdad: Archivo externo lang_map.csv o Google Sheet.

Columna A: KEY_INTERNA (ej: BTN_EXPORT_MIDI)

Columna B: TEXTO_EU (ej: Esportatu MIDI)

Carga: Al iniciar, la app carga el mapa en un diccionario. Los botones consultan este diccionario por su Key.

6. Protocolo de Desarrollo (Anti-Amnesia)
Modularidad: No reescribir archivos enteros de más de 200 líneas. Solicitar/Generar cambios por funciones o clases.

Seguridad: Encoding UTF-8 forzado siempre.

Persistencia: Antes de cada sesión importante, el usuario subirá este documento y el estado actual del código para refrescar el contexto de la IA.